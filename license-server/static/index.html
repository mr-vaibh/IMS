<!DOCTYPE html>
<html>
<head>
  <title>IMS License Manager</title>
  <style>
    body { font-family: sans-serif; margin: 40px; }
    input, button { padding: 8px; margin: 4px; }
    table { margin-top: 20px; border-collapse: collapse; }
    td, th { border: 1px solid #ccc; padding: 8px; }
  </style>
</head>
<body>

<h2>IMS License Manager</h2>

<h3>Allow Instance</h3>
<input id="instance" placeholder="instance_id" />
<input id="company" placeholder="company name" />
<button onclick="allow()">Allow</button>

<h3>Active Licenses</h3>
<table id="table">
  <tr><th>Instance ID</th><th>Company</th><th>Action</th></tr>
</table>

<script>
async function fetchLicenses() {
  try {
    const res = await fetch("/admin/licenses");
    if (!res.ok) {
      alert("Failed to load licenses: " + res.status);
      return;
    }

    const data = await res.json();
    const table = document.getElementById("table");

    table.innerHTML = "<tr><th>Instance ID</th><th>Company</th><th>Action</th></tr>";

    data.forEach(l => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${l.instance_id}</td>
        <td>${l.company_name || ""}</td>
        <td><button onclick="revoke('${l.instance_id}')">Revoke</button></td>
      `;
      table.appendChild(row);
    });
  } catch (e) {
    alert("Error loading licenses");
    console.error(e);
  }
}

async function allow() {
  const instance = document.getElementById("instance").value;
  const company = document.getElementById("company").value;

  await fetch(`/admin/allow?instance_id=${instance}&company=${company}`, { method: "POST" });
  fetchLicenses();
}

async function revoke(id) {
  await fetch(`/admin/revoke?instance_id=${id}`, { method: "POST" });
  fetchLicenses();
}

fetchLicenses();
</script>

</body>
</html>
